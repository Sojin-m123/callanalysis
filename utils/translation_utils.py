from deep_translator import GoogleTranslator
from transformers import pipeline

# Fallback model cache
translator_pipeline = None  # Global cache for NLLB model

# Optional: device setup (CUDA if available)
import torch
device = 0 if torch.cuda.is_available() else -1

malayalam_reverse_map = {
            'เดเดถเดฏเดตเตเดฎเดฟเดฒเตเดฒ': 'เดเดกเดฟเดฏเดฏเตเดฎเดฟเดฒเตเดฒ',
            'เดเดจเตเดจเต ': 'เดจเดฟเดจเตเดจเตเด ',
            'เดเตเดฏเตเดฏเดพเตป': 'เดเตเดฏเตเดฏเดพเดตเต',
            'เดชเดฐเดฟเดนเดพเดฐเดเตเดเดณเตเด': 'เดธเตเดฒเตเดฏเตเดทเตปเดธเต',
            'เดชเดฐเดฟเดถเตเดฒเดจเดพเตผเดคเตเดฅเดฟ': 'เดเตเดฐเตเดฏเดฟเดจเต',
            'เดคเตเดฐเตเดฎเดพเดจเด': 'เดกเดฟเดธเดฟเดทเตป',
            'เดเดฆเตเดฏเตเดเด': 'เดเตเดฌเต',
            'เดชเดฆเตเดงเดคเดฟ': 'เดชเตเดฐเตเดเดเตเดเต',
            'เดธเดฎเดธเตเดฏ': 'เดชเตเดฐเตเดฌเตเดฒเด',
            'เดธเดนเดพเดฏเด': 'เดนเตเตฝเดชเตเดชเต',
            'เดเดฆเดพเดนเดฐเดฃเด': 'เดเดเตเดธเดพเดเดชเดฟเตพ',
            'เดตเดฟเดตเดฐเดฃเด': 'เดกเดฟเดธเตโเดเตเดฐเดฟเดชเตเดทเตป',
            'เดตเดฟเดฒเดฏเดฟเดฐเตเดคเตเดคเตฝ': 'เดเดตเดพเดฒเตเดตเตเดทเตป',
            'เดชเดฐเตเดเตเดทเดฃเด': 'เดเตเดธเตเดฑเตเดฑเต',
            'เดชเดฐเตเดเตเดท': 'เดเดเตเดธเดพเด',
            'เดชเดเดจเด': 'เดธเตเดฑเตเดฑเดกเดฟ',
            'เดตเดฟเดฆเตเดฏเดพเตผเดคเตเดฅเดฟ': 'เดธเตเดฑเตเดฑเตเดกเดจเตเดฑเต',
            'เดตเตเดฏเดพเดชเดพเดฐเด': 'เดฌเดฟเดธเดฟเดจเดธเต',
            'เดคเตเดดเดฟเดฒเดพเดณเดฟ': 'เดเดเดชเตเดฒเตเดฏเดฟ',
            'เดเดฆเตเดฏเตเดเดธเตเดฅเตป': 'เดธเตเดฑเตเดฑเดพเดซเต',
            'เดเตเดเดฟเดฏเดพเดฒเตเดเดจ': 'เดฎเตเดฑเตเดฑเดฟเดเดเต',
            'เดเดฐเดเดญเด': 'เดธเตเดฑเตเดฑเดพเตผเดเตเดเต',
            'เดเดตเดธเดพเดจเด': 'เดเตปเดกเต',
            'เดธเดเดถเดฏเด': 'เดกเตเดเตเดเต',
            'เดชเดฟเดจเตเดคเตเดฃ': 'เดธเดชเตเดชเตเตผเดเตเดเต',
            'เดเดถเตเดตเดพเดธเด': 'เดฑเดฟเดฒเตเดซเต',
            'เดคเดพเดฒเตเดชเดฐเตเดฏเด': 'เดเดจเตเดฑเดฑเดธเตเดฑเตเดฑเต',
            'เดชเตเดฐเดคเดฟเดซเดฒเด': 'เดฑเดฟเดตเดพเตผเดกเต',
            'เดชเดฐเดฟเดถเตเดงเดจ': 'เดเตเดเตเดเต',
            'เดเดชเดเดฐเดฃเดเตเดเตพ': 'เดเตเตพเดธเต',
            'เดคเตเดณเดฟเดตเต': 'เดชเตเดฐเตเดซเต',
            'เดเดจเตเดฎเดคเดฟ': 'เดชเตผเดฎเดฟเดทเตป',
            'เดฒเดเตเดทเตเดฏเด': 'เดเตเตพ',
            'เดตเตเดญเดตเด': 'เดเตเดฒเดพเดฎเตผ',
            'เดธเดเดฐเดเตเดทเดฃเด': 'เดธเตเดเตเดฏเตเดฐเดฟเดฑเตเดฑเดฟ',
            'เดจเดฏเด': 'เดชเตเดณเดฟเดธเดฟ',
            'เดชเดฐเดฟเดงเดฟ': 'เดฒเดฟเดฎเดฟเดฑเตเดฑเต',
            'เดชเดฐเตเดเตเดทเดฃเดเดเตเดเด': 'เดชเตเดฒเดฑเตเดฑเต',
            'เดธเดตเดฟเดถเตเดทเดค': 'เดซเตเดเตเดเตผ',
            'เดคเดฟเดเดเตเดเดคเต': 'เดเดชเตเดฑเตเดฑเดฟเดฎเตฝ',
            'เดฎเดพเดฑเตเดฑเด': 'เดเตเดเตเดเต',
            'เดเดชเดญเตเดเตเดคเดพเดตเต': 'เดฏเตเดธเตผ',
            'เดชเตเดฐเดเดเดจเด': 'เดชเตเตผเดซเตเดฎเตปเดธเต',
            'เดตเดฟเดถเตเดตเดพเดธเด': 'เดเตเดฐเดธเตเดฑเตเดฑเต',
            'เดตเตเดญเดตเด': 'เดเตเดฐเดพเตปเดกเตผ',
            'เดตเดฟเดซเดฒเด': 'เดซเตเดฏเดฟเตฝเดกเต',
            'เดตเดฟเดเดฏเด': 'เดธเดเตเดธเดธเต',
            'เดจเดฟเดฐเตโเดฃเตเดฃเดฏเด': 'เดเดกเตเดเตเดฎเตเดจเตเดฑเต',
            'เดชเตเดฐเดคเตเดเตเดท': 'เดเดเตโเดธเตโเดชเตเดเตเดเตเดทเตป',
            'เดเดตเดธเดฐเด': 'เดเดชเตเดชเตผเดเตเดฏเตเดฃเดฟเดฑเตเดฑเดฟ',
            'เดคเตเดฐเตเดตเดฟเตฝ': 'เดซเตเดจเดฒเดพเดฏเดฟ',
            'เดเดฃเตเดฃเตเดเตเดเต': 'เดซเตเดเตเดเดธเต',
            'เดคเตเดณเดฟเดตเดพเดเตเดเตเด': 'เดตเตเดฐเดฟเดซเต เดเตเดฏเตเดฏเตเด',
            'เดฎเดพเดฑเตเดฑเดฟเดตเตเดเตเดเตเด': 'เดฑเตเดทเตเดกเตเดฏเตเตพ เดเตเดฏเตเดฏเตเด',
            'เดจเตฝเดเตเด': 'เดชเตเดฐเตเดตเตเดกเต เดเตเดฏเตเดฏเตเด',
            'เดชเดฐเดฟเดทเตเดเดฐเดฃเด': 'เดเดชเตเดชเตโเดกเตเดฑเตเดฑเต',
            'เดคเดฟเดฐเดเตเดเตเดเตเดคเตเดคเดคเต': 'เดธเตเดฒเตเดเตเดเต เดเตเดฏเตเดคเดคเต',
            'เดคเดฟเดฐเดเตเดเตเดเตเดชเตเดชเต': 'เดเดชเตเดทเตป',
            'เดธเตเดฅเดฟเดฐเตเดเดฐเดฃเด': 'เดเตเตบเดซเตผเดฎเตเดทเตป',
            'เดเดฟเดเตเด': 'เดชเตเดฒเดพเตป',
            'เดชเดฐเดพเดฎเตผเดถเด': 'เดฑเดซเดฑเตปเดธเต',
            'เดฎเดพเดฑเตเดฑเด': 'เดฎเตเดกเดฟเดซเดฟเดเตเดเตเดทเตป',
            'เดเดญเดฟเดชเตเดฐเดพเดฏเด': 'เดซเตเดกเตโเดฌเดพเดเตเดเต',
            'เดเดพเดดเตเดเดชเตเดชเดพเดเต': 'เดตเตเดฏเต',
            'เดชเดฟเดจเตเดคเตเดเดฐเตเด': 'เดซเตเดณเต เดเตเดฏเตเดฏเตเด',
            'เดญเดฐเดฃเดธเดเดตเดฟเดงเดพเดจเด': 'เดฎเดพเดจเตเดเตเดฎเตเดจเตเดฑเต',
            'เดเดจเตเดญเดตเด': 'เดเดเตเดธเตเดชเตเดฐเดฟเดฏเตปเดธเต',
            'เดเดฃเตเดเต': 'เดตเตเดฃเต',
            'เดคเดจเตเดคเตเดฐเดถเดพเดธเตเดคเตเดฐ เดธเตเดฅเดพเดชเดจเด': 'เดเดเดฟ เดซเดฟเตผเด',
            'เดจเดฏเด': 'เดชเตเดณเดฟเดธเดฟ',
            'เดชเดฐเดฟเดเดฃเดจ': 'เดเตบเดธเดฟเดกเดฑเตเดทเตป',
            'เดจเดฟเดฌเดจเตเดงเดจเดเตพ': 'เดเตเดเดธเต',
            'เดธเดฎเดฟเดคเดฟ': 'เดเดฎเตเดฎเดฟเดฑเตเดฑเดฟ',
            'เดจเดฟเดเตเดทเตเดชเด': 'เดเตปเดตเตเดธเตเดฑเตเดฑเตโเดฎเตเดจเตเดฑเต',
            'เดธเดเดฐเดเดญเด': 'เดธเตเดฑเตเดฑเดพเตผเดเตเดเดชเตเดชเต',
            'เดคเตเดดเดฟเตฝ': 'เดเตเดฌเต',
            'เดชเดฐเดฟเดถเตเดฒเดจเด': 'เดเตเดฐเตเดฏเดฟเดจเดฟเดเดเต',
            'เดตเดพเดฏเตเดช': 'เดฒเตเตบ',
            'เดคเดฐเดเดเด': 'เดเตเดฐเตเตปเดกเต',
            'เดจเดฟเดเตเดทเตเดชเดเดจเตโ': 'เดเตปเดตเตเดธเตเดฑเตเดฑเตผ',
            'เดชเดฆเตเดงเดคเดฟ': 'เดชเตเดฐเตเดเดเตเดเต',
            'เดเดตเดเดพเดถเด': 'เดฑเตเดฑเตเดฑเตโเดธเต',
            'เดธเตเดฐเดเตเดท': 'เดธเตเดเตเดฏเตเดฐเดฟเดฑเตเดฑเดฟ',
            'เดเดจเตเดฎเดคเดฟ': 'เดชเดฐเดฎเดฟเดทเตป',
            'เดจเดฏเดคเดจเตเดคเตเดฐเด': 'เดกเดฟเดชเตเดฒเตเดฎเดธเดฟ',
            'เดตเดฟเดจเดฟเดฎเดฏเด': 'เดเตเดฐเดพเตปเดธเดพเดเตเดทเตป',
            'เดชเดฐเดฟเดนเดพเดฐเดเตเดเดณเตเด': 'เดธเตเดฒเตเดฏเตเดทเตปเดธเต',
            'เดฎเตเตป/เดฎเตเตป เดเตเดเตโเดจเตเดณเดเดฟ เดชเตเดฒเดพเดฑเตเดฑเตเดซเตเด': 'เดฎเตเตป เดเตปเดกเต เดฎเตเตป เดธเตเดฑเตเดฑเดพเดเตเดเต',
            'เดเดตเดถเตเดฏ เดชเตเดฐเดฏเตเด เดจเดฟเตผเดฎเตเดฎเดพเดฃเด': 'เดเดชเตเดฒเดฟเดเตเดเตเดทเตป เดกเตเดตเดฒเดชเตเดฎเตเดจเตเดฑเต',
            'เดเดจเตเดญเดต เดธเตผเดเตเดเดฟเดซเดฟเดเตเดเดฑเตเดฑเต': 'เดเดเตเดธเตเดชเตเดฐเดฟเดฏเตปเดธเต เดธเตผเดเตเดเดฟเดซเดฟเดเตเดเดฑเตเดฑเต',
            'เดคเดฟเดฐเดเตเดเตเดเตเดคเตเดค เดชเตเดฐเดเตเดฐเดฟเดฏ': 'เดธเตเดเตเดฐเตเดจเดฟเดเดเต เดชเตเดฐเตเดธเดธเตเดธเต',
            'เดเดจเตเดฑเตผเดจเตเดฑเตเดฑเต เดธเตเดฐเดเตเดทเดพ': 'เดธเตเดฌเตผ เดธเตเดเตเดฏเตเดฐเดฟเดฑเตเดฑเดฟ',
            'เดกเดพเดฑเตเดฑเดพ เดถเดพเดธเตเดคเตเดฐเด': 'เดกเตเดฑเตเดฑ เดธเดฏเตปเดธเต',
            'เดเตเดตเดจเตเดค เดชเดฆเตเดงเดคเดฟเดเตพ': 'เดฒเตเดตเต เดชเตเดฐเตเดเดเตเดเตเดธเต',
            'เดเตเดตเดจเตเดค เดชเดฐเดฟเดถเตเดฒเดจเด': 'เดฒเตเดตเต เดเตเดฐเตเดฏเดฟเดจเดฟเดเดเต',
            'เดชเดฃเดฎเตเดฑเตเดฑเต เดชเดฐเดฟเดถเตเดฒเดจเด': 'เดชเตเดฏเตเดกเต เดเดจเตเดฑเตเตบเดทเดฟเดชเตเดชเต',
            'เดธเตเดฐเดเตเดทเดพ เดชเดฐเดฟเดนเดพเดฐเดเตเดเตพ': 'เดธเตเดเตเดฏเตเดฐเดฟเดฑเตเดฑเดฟ เดธเตเดฒเตเดฏเตเดทเตปเดธเต',
            'เดชเตเตผเดคเตเดคเตเดเดฐเดฃ เดธเตผเดเตเดเดฟเดซเดฟเดเตเดเดฑเตเดฑเต': 'เดธเตผเดเตเดเดฟเดซเดฟเดเตเดเดฑเตเดฑเต เดเดซเต เดเดฎเตเดชเตเดฒเตเดทเตป',
            'เดเตเดเตเดคเตฝ เดตเดฟเดตเดฐเด': 'เดฎเตเตผ เดเตปเดซเตผเดฎเตเดทเตป',
            'เดเดตเดถเตเดฏเดฎเดฟเดฒเตเดฒ': 'เดจเต เดจเตเดกเต',
            'เดธเดพเดงเตเดฏเดฎเดฒเตเดฒ': 'เดจเตเดเตเดเต เดชเตเดธเดฟเดฌเดฟเตพ',
            'เดเดฑเดฟเดฏเดฟเดชเตเดชเต เดฒเดญเดฟเดเตเดเต': 'เดจเตเดเตเดเดฟเดซเดฟเดเตเดเตเดทเตป เดฑเดฟเดธเตเดตเตเดกเต',
            'เดเดฑเดพเดฏเดฟเดฐเด': 'เดธเดฟเดเตเดธเต เดคเตเดธเตปเดกเต',
            'เดธเตเดซเตเดฑเตเดฑเตเดตเตเดฏเดฑเดฟเตฝ': 'เดธเตเดซเตเดฑเตเดฑเตโเดตเตเดฏเตผ',
            'เดชเดฐเดฟเดนเดพเดฐเดเตเดเตพ': 'เดธเตเดฒเตเดฏเตเดทเตปเดธเต',
            'เดชเดฐเดฟเดนเดพเดฐเด': 'เดธเตเดฒเตเดฏเตเดทเตป',
            'เดฎเตเดฆเตเดธเตเดฅเดฟเดคเดฟ เดชเตเดฐเดฏเตเดเด': 'เดธเตเดซเตเดฑเตเดฑเตโเดตเตเดฏเตผ',
            'เดชเดฐเดฟเดถเตเดฒเดจเด': 'เดเดจเตเดฑเตเตบเดทเดฟเดชเตเดชเต',
            'เดธเดพเดเตเดทเตเดฏเดชเดคเตเดฐเด': 'เดธเตผเดเตเดเดฟเดซเดฟเดเตเดเดฑเตเดฑเต',
            'เดเดเดฟเดธเตเดฅเดพเดจเดเดเดจ': 'เดซเตเดฐเตเดฏเดฟเดเดตเตผเดเตเดเต',
            'เดเตเดฆเตเดฏเตเดพเดคเตเดคเดฐเดธเดฎเดฐเด': 'เดเดจเตเดฑเตผเดตเตเดฏเต',
            'เดคเตเดดเดฟเตฝเดจเดฟเดฏเดฎเดจเด': 'เดชเตเดฒเตเดธเตเดฎเตเดจเตเดฑเต',
            'เดญเดฐเดฃเดธเดเดตเดฟเดงเดพเดจเด': 'เดฎเดพเดจเตเดเตเดฎเตเดจเตเดฑเต',
            'เดเดจเตเดญเดตเด': 'เดเดเตเดธเตเดชเตเดฐเดฟเดฏเตปเดธเต',
            'เดเดฃเตเดเต': 'เดตเตเดฃเต',
            'เดคเดจเตเดคเตเดฐเดถเดพเดธเตเดคเตเดฐ เดธเตเดฅเดพเดชเดจเด': 'เดเดเดฟ เดซเดฟเตผเด',
            'เดชเดฐเดฟเดนเดพเดฐเดตเตเดฎเดพเดฏเดฟ': 'เดธเตเดฒเตเดทเตปเดธเต',
            'เดตเดพเดเตเดเตโเดธเดพเดชเตเดชเต': 'เดตเดพเดเตเดเตโเดธเดพเดชเตเดชเต',
            'เดธเตเดฐเดเตเดทเดพ': 'เดธเตเดเตเดฏเตเดฐเดฟเดฑเตเดฑเดฟ',
            'เดธเตเดฅเดพเดชเดจเด': 'เดเดฎเตเดชเดจเดฟ',
            'เดชเดฆเตเดงเดคเดฟ': 'เดชเตเดฐเตเดเดเตเดเต',
            'เดฌเดจเตเดงเดชเตเดชเตเดเตเดจเตเดจเต': 'เดตเดฟเดณเดฟเดเตเดเตเดจเตเดจเต',
            'เดเตเดเดฟเตพ': 'เดเตเดเดฟเตพ',
            'เดชเดฐเดฟเดนเดพเดฐเดตเตเด': 'เดธเตเดฒเตเดทเตปเดธเต',
            'เดเตเดคเตเดฐเดฟเดฎ เดฌเตเดฆเตเดงเดฟเดฎเดคเตเดคเดพ': 'เดเด',
            'เดฎเตเดทเตเตป เดฒเตเดฃเดฟเดเดเต': 'เดเดเดเตฝ',
            'เดฎเดพเดจเดต เดตเดฟเดญเดตเดถเตเดทเดฟ': 'เดเดเต เดเตผ',
            'เดฏเตเดเตเดฏเดค': 'เดเตเดตเดพเดณเดฟเดซเดฟเดเตเดเตเดทเตป',
            'เดจเดฟเดเตเดคเดฟ': 'เดซเต',
            'เดตเดฟเดถเดฆเดพเดเดถเดเตเดเตพ': 'เดกเตเดฑเตเดฑเตเดฏเดฟเตฝเดธเต',
            'เดชเตเดฐเดเดพเดฐเดฃ เดชเดคเตเดฐเดฟเด': 'เดฌเตเดฐเตเดทเตผ',
            'เดเดตเดเดพเดถเดฎเดพเดฃเต?': 'เดเดฃเต',
            'เดตเดฟเดตเดฐเดเตเดเตพ': 'เดกเตเดฑเตเดฑเตเดฏเดฟเตฝเดธเต',
            'เดเดจเตเดตเตเดทเดฃเด': 'เดเตปเดเตเดตเดฏเดฑเดฟ',
            'เดคเดฟเดฐเดฏเตเดจเตเดจเต': 'เดจเตเดเตเดเดฟเดฏเดฟเดฐเตเดจเตเดจเต',
            'เดชเดเตเดเดฟเดเดพเตป': 'เดทเตเดฏเตผ',
            'เดชเดฐเดฟเดนเดพเดฐเดเตเดเดณเดฟเตฝ': 'เดธเตเดฒเตเดฏเตเดทเตปเดธเต', 
            'เดตเดฟเดถเดฆเดพเดเดถเดเตเดเดณเตเด': 'เดกเตเดฑเตเดฑเตเดฏเดฟเตฝเดธเต',
            'เดเดตเดธเดฐเดเตเดเตพ': 'เดเดชเตเดชเตผเดเตเดฏเตเดฃเดฟเดฑเตเดฑเตเดธเต',
            'เดธเดพเดเตเดเตเดคเดฟเดเดตเดฟเดฆเตเดฏ': 'เดเตเดเตโเดจเตเดณเดเดฟ',
            'เดธเดพเดเตเดเตเดคเดฟเดเดตเดฟเดฆเตเดฏเดเตพ': 'เดเตเดเตโเดจเตเดณเดเตเดธเต',
            'เดธเดพเดเตเดเตเดคเดฟเดเดตเดฟเดฆเตเดฏเดฏเตเดเต': 'เดเตเดเตโเดจเตเดณเดเดฟเดฏเตเดเต',
            'เดธเดพเดเตเดเตเดคเดฟเดเดตเดฟเดฆเตเดฏเดเตพเดเตเดเต': 'เดเตเดเตโเดจเตเดณเดเดฟเดเตพเดเตเดเต',
            'เดถเดฐเดฟ': 'เดเดเตเดเต ',
            'เดเดจเตเดฑเตผเดตเตเดฏเต': 'เดเดจเตเดฑเตผเดตเตเดฏเต',
            'เดชเดฐเดฟเดถเตเดฒเดจเด': 'เดเตเดฐเตเดฏเดฟเดจเดฟเดเดเต',
            'เดชเดฐเดฟเดถเตเดฒเดจเดคเตเดคเดฟเดจเดพเดฏเดฟ': 'เดเตเดฐเตเดฏเดฟเดจเดฟเดเดเดฟเดจเดพเดฏเดฟ',
            'เดธเตเดชเตเดฐเดญเดพเดคเด': 'เดเตเดกเตเดฎเตเดฑเตเดจเดฟเดเดเต',
            'เดคเดฟเดฐเดฏเตเดเดฏเดพเดฃเต': 'เดจเตเดเตเดเตเดเดฏเดพเดฃเต ',
            'เดคเดฟเดฐเดฏเตเดจเตเดจเดคเต': 'เดจเตเดเตเดเตเดจเตเดจเดคเต',
            'เดชเดเตเดเดฟเดเตเด': 'เดทเตเดฏเตผ เดเตเดฏเตเดฏเตเด',
            'เดชเดเตเดเดฟเดเตเดจเตเดจเต': 'เดทเตเดฏเตผ เดเตเดฏเตเดฏเตเดจเตเดจเต',
            'เดชเดเตเดเดฟเดเดพเตป': 'เดทเตเดฏเตผ เดเตเดฏเตเดฏเดพเตป',
            'เดเดฟเดดเดฟเดตเต ': 'เดกเดฟเดธเตโเดเตเดฃเตเดเต',
            'เดฎเตเดฌเตเตฝ เดตเดฟเดเดธเดจเดคเตเดคเดฟเดจเดพเดฏเดฟ': 'เดฎเตเดฌเตเตฝ เดกเตเดตเดฒเดชเตเดฎเตเดจเตเดฑเดฟเดจเดพเดฏเดฟ',
            'เดชเตเดฐเดตเตผเดคเตเดคเดฟเดเตเดเตเดจเตเดจเต': 'เดตเตผเดเตเดเดฟเดเดเต',
            'เดชเตเดฐเดตเตผเดคเตเดคเดฟเดเตเดเดพเตป': 'เดตเตผเดเตเดเดฟเดเดเต',
            'เดชเดเตเดเดฟเดเดเตเดเต': 'เดทเตเดฏเตผ เดเตเดฏเตเดฏเดเตเดเต',
            'เดชเดฐเดฟเดถเตเดฒเดจเดคเตเดคเตเดฏเตเด': 'เดเตเดฐเตเดฏเดฟเดจเดฟเดเดเดฟเดจเตเดฏเตเด',
            'เดคเดฟเดฐเดฏเตเดเดฏเดพเดฃเต.    ': 'เดจเตเดเตเดเตเดเดฏเดพเดฃเต.',
            'เดตเดฟเดเดธเดจเดคเตเดคเดฟเดจเดพเดฏเดฟ':'เดกเตเดตเดฒเตเดชเตเดฎเตเดจเตเดฑเดฟเดจเดพเดฏเดฟ ',
            'เดญเตเดคเดฟเดเดถเดพเดธเตเดคเตเดฐเด': 'เดซเดฟเดธเดฟเดเตเดธเต',
            'เดชเดฐเดฟเดถเตเดฒเดจ เดธเตผเดเตเดเดฟเดซเดฟเดเตเดเตเดทเดจเดพเดฃเต': 'เดเตเดฐเตเดฏเดฟเดจเดฟเดเดเต เดธเตผเดเตเดเดฟเดซเดฟเดเตเดเตเดทเตป',
            'เดเดคเต':'เดฏเตเดธเต ',
            'เดเดเตเดเดคเดฟเดฐเดฟเดเตเดเต ':'เดเตเดกเต เดเดซเตเดฑเตเตผเตเตบ  '


        }
    

def translate_to_malayalam(text_or_dict):
    global translator_pipeline  # To modify the global cached translator

    try:
        text = text_or_dict.get('raw_transcription', '') if isinstance(text_or_dict, dict) else text_or_dict
        if not text.strip():
            raise ValueError("No text found for translation")

        print("๐ค Translating to Malayalam using Google Translator...")
        try:
            ml_text = GoogleTranslator(source='en', target='ml').translate(text)
        except Exception as google_error:
            print(f"โ๏ธ Google Translator failed: {str(google_error)}. Falling back to NLLB...")

            if translator_pipeline is None:
                try:
                    translator_pipeline = pipeline(
                        "translation",
                        model="facebook/nllb-200-distilled-600M",
                        src_lang="eng_Latn",
                        tgt_lang="mal_Mlym",
                        device=device
                    )
                    print(f"โ NLLB pipeline loaded on device: {'CUDA' if device == 0 else 'CPU'}")
                except Exception as e:
                    print(f"โ Failed to load NLLB model: {str(e)}")
                    raise

            ml_text = translator_pipeline(text, max_length=512)[0]['translation_text']

        # Word replacements
        for original, replacement in malayalam_reverse_map.items():
            ml_text = ml_text.replace(original, replacement)

        # Return updated dict or string
        if isinstance(text_or_dict, dict):
            text_or_dict['translated_malayalam'] = ml_text
            return text_or_dict
        return ml_text

    except Exception as e:
        print(f"โ Translation error: {str(e)}")
        return text_or_dict